<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build &amp; deploy a high-availability web application using CloudFormation AWS.</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="/js/main.js"></script>
</head>
<body>
    

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/project/">Projects</a></div>
    <h1 class="post-title entry-hint-parent">
      Build &amp; deploy a high-availability web application using CloudFormation AWS.
    </h1>
    <div class="post-description">
      Build &amp; deploy a high-availability web application using CloudFormation AWS.
    </div>
    <div class="post-meta">3 min&nbsp;·&nbsp;Me

</div>
  </header> 
  <div class="post-content"><h2 id="kiến-trúc-dự-án">Kiến trúc dự án<a hidden class="anchor" aria-hidden="true" href="#kiến-trúc-dự-án">#</a></h2>
<p><img loading="lazy" src="/images/cfn/aws-cfn.png" alt="Images"  />
</p>
<h3 id="cloudformation-là-gì">CloudFormation là gì?<a hidden class="anchor" aria-hidden="true" href="#cloudformation-là-gì">#</a></h3>
<ul>
<li>
<p>CloudFormation là một dịch vụ Infrastructure as Code được phát triển bởi Amazon Web Service, nó cho phép chúng ta define all resouces và tự động triển khai trên AWS bằng cách thông qua giao diện dòng lệnh. Việc sử dụng CloudFormation mang lại nhiều lợi ích ví dụ như:</p>
<ul>
<li>Triển khai được trên nhiều môi trường.</li>
<li>Tối ưu hóa thời gian.</li>
<li>Nhất quán và dễ dàng triển khai.</li>
<li>Tái sử dụng templates.</li>
</ul>
</li>
<li>
<p>CloudFormation sử dụng 2 loại type: yaml or json ( trong dự án này mình sử dụng loại type yaml vì nó dễ nhìn).</p>
</li>
<li>
<p>Ngoài ra, còn rất nhiều các chức năng trong CloudFormation mọi người có thể view tại đây:</p>
<p><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference.html">https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference.html</a></p>
</li>
</ul>
<h3 id="giới-thiệu-về-dự-án">Giới thiệu về dự án:<a hidden class="anchor" aria-hidden="true" href="#giới-thiệu-về-dự-án">#</a></h3>
<ul>
<li>Bạn đang muốn triển khai một ứng dụng web trên AWS, tuy nhiên bạn không muốn triển khai theo thủ công. Vì bạn muốn có thể tái sử dụng lại những resources đó vào những dự án cá nhân khác. Bạn sẽ sử dụng IaC để giúp bạn triển khai ứng dụng này.</li>
</ul>
<h4 id="cidr-network">CIDR Network<a hidden class="anchor" aria-hidden="true" href="#cidr-network">#</a></h4>
<ul>
<li>CIDR VPC: 172.16.0.0/24</li>
<li>CIDR Public Subnet 1: 172.16.0.0/26</li>
<li>CIDR Public Subnet 2: 172.16.0.64/26</li>
<li>CIDR Private Subnet 1: 172.16.0.128/26</li>
<li>CIDR Private Subnet 2: 172.16.0.192/26</li>
</ul>
<h3 id="yêu-cầu-dự-án">Yêu cầu dự án:<a hidden class="anchor" aria-hidden="true" href="#yêu-cầu-dự-án">#</a></h3>
<h4 id="network-infra">Network-Infra<a hidden class="anchor" aria-hidden="true" href="#network-infra">#</a></h4>
<ul>
<li>Tạo VPC</li>
<li>Tạo 4 subnets trên 2 Zone</li>
<li>Tạo Route table cho mỗi subnets</li>
<li>Tạo Internet Gateway</li>
<li>Tạo Nat Gateway (để các resources trong private subnet có thể truy cập Internet)</li>
</ul>
<h4 id="server-infra">Server-Infra<a hidden class="anchor" aria-hidden="true" href="#server-infra">#</a></h4>
<ul>
<li>Tạo Bastion-host ở public Subnet (để access tới các server trong private subnet)</li>
<li>Tạo Security Group cho all các objects: Bastion-host, ALB, and Prod</li>
<li>Tạo Launch-Template để sử dụng khi triển khai ASG</li>
<li>Tạo Application Load Balancer để route traffic đến các instances</li>
<li>Tạo Auto Scaling Group để scale out/in instances.</li>
<li>Tạo Certificate manager để cấp SSL/TLS mã hóa trên đường truyền</li>
<li>Tạo Iam Role cho instance có quyền read/write đến S3</li>
</ul>
<h3 id="điều-kiện-hoàn-thành">Điều kiện hoàn thành:<a hidden class="anchor" aria-hidden="true" href="#điều-kiện-hoàn-thành">#</a></h3>
<ul>
<li>Ứng dụng có tính khả dụng cao</li>
<li>Application Load Balancer cung cấp dns <a href="https://dns-alb.com">https://dns-alb.com</a> cho các client truy cập vào.</li>
<li>Scale out các instances như theo kiến trúc</li>
<li>Instances trong private subnet có thể read/write đến S3.</li>
<li>Nat Gateway cho các instances trong private subnet</li>
</ul>
<h3 id="các-bước-thực-hiện">Các bước thực hiện:<a hidden class="anchor" aria-hidden="true" href="#các-bước-thực-hiện">#</a></h3>
<ul>
<li>Sử dụng Visual Studio Code để code 2 File: Network-infra.yaml and Server-infra.yaml</li>
<li>File 1: Network-infra.yaml</li>
<li>File 2: Server-infra.yaml</li>
<li>Mọi người có thể tham khảo source code của mình tại đây:</li>
</ul>
<p><a href="https://github.com/hs-nguyen/Build-deploy-a-high-availability-web-application-using-CloudFormation-AWS">https://github.com/hs-nguyen/Build-deploy-a-high-availability-web-application-using-CloudFormation-AWS</a></p>
<h4 id="tại-console-aws-click-cloudformation">Tại Console AWS: Click CloudFormation.<a hidden class="anchor" aria-hidden="true" href="#tại-console-aws-click-cloudformation">#</a></h4>
<ul>
<li>
<p>Click CloudFormation
<img loading="lazy" src="/images/cfn/cfn.png" alt="Images"  />
</p>
</li>
<li>
<p>Click Create Stack
<img loading="lazy" src="/images/cfn/create-stack.png" alt="Images"  />
</p>
</li>
<li>
<p>Upload file Network-infra.yaml =&gt; Next
<img loading="lazy" src="/images/cfn/up-load-file-network.png" alt="Images"  />
</p>
</li>
<li>
<p>Stack name: Demo-Network-Infra
<img loading="lazy" src="/images/cfn/stack-name.png" alt="Images"  />

<img loading="lazy" src="/images/cfn/parameters.png" alt="Images"  />
</p>
</li>
<li>
<p>Cấu hình stack (options) =&gt; Next
<img loading="lazy" src="/images/cfn/configure-stack.png" alt="Images"  />

<img loading="lazy" src="/images/cfn/configure-stack-1.png" alt="Images"  />
</p>
</li>
<li>
<p>Review and create
<img loading="lazy" src="/images/cfn/review-stack.png" alt="Images"  />

<img loading="lazy" src="/images/cfn/review-stack-1.png" alt="Images"  />
</p>
</li>
<li>
<p>Click Submit
<img loading="lazy" src="/images/cfn/submit.png" alt="Images"  />
</p>
</li>
<li>
<p>Quá trình triển khai hạ tầng network sẽ mất từ 2 -&gt; 3 phút.
<img loading="lazy" src="/images/cfn/submit-network.png" alt="Images"  />
</p>
</li>
<li>
<p>Tiếp đến Create Stack: Server-infra.yaml các bước thực hiện giống như tạo stack Network-infra</p>
</li>
<li>
<p>Quá trình triển khai hạ tầng Server mất từ 1 - 2 phút.
<img loading="lazy" src="/images/cfn/submit-server.png" alt="Images"  />
</p>
</li>
<li>
<p>Check &amp; Confirm lại configure</p>
</li>
<li>
<p>Truy cập dns name: <a href="https://d-alb-prod-973693012.us-east-1.elb.amazonaws.com/">https://d-alb-prod-973693012.us-east-1.elb.amazonaws.com/</a></p>
</li>
<li>
<p>Có thể sử dụng Route 53 để registry domain thay thế DNS của Load Balancer.</p>
</li>
<li>
<p>Tiếp đến access vào EC2 Instance trong Private subnet list s3 bucket.</p>
</li>
<li>
<p>Sử dụng Bastion-host EC2 làm trung gian access đến instances trong Private Subnet.
<img loading="lazy" src="/images/cfn/bastion-host.png" alt="Images"  />
</p>
</li>
<li>
<p>Tạo Keypair file =&gt; copy key vào bên trong file
<img loading="lazy" src="/images/cfn/create-keypair-file.png" alt="Images"  />

<img loading="lazy" src="/images/cfn/cp-keypair.png" alt="Images"  />
</p>
</li>
<li>
<p>Sau đó SSH vào các EC2 Instances trong Private Subnet
<img loading="lazy" src="/images/cfn/ssh-private-instance.png" alt="Images"  />
</p>
</li>
<li>
<p>List s3 bucket</p>
</li>
<li>
<p><strong>CLI</strong>: aws s3 ls
<img loading="lazy" src="/images/cfn/check-list-s3.png" alt="Images"  />
</p>
</li>
</ul>
<p>Okay, vậy là mình đã triển khai thành công ứng dụng web đảm bảo tính khả dụng cao thông qua giao diện dòng lệnh. Đây là project cũng không có gì quá cao siêu nhưng nó cũng là thành quả thời gian mà mình bỏ ra, hy vọng project này có thể giúp các bạn một phần nào trong hành trình lên mây của mình.</p>
<p>Chúc các bạn thành công!</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/aws/">AWS</a></li>
      <li><a href="http://localhost:1313/tags/cloudformation/">CloudFormation</a></li>
    </ul>

  </footer>
</article>
</body>
</html>
